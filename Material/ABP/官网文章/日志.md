[TOC]

## 服务端

ABP 使用 Castle Windsor 的日志基础设施。它可以使用不同的日志库：Log4Net，NLog，Serilog。。。Castle为所有记录器库提供了一个公共接口。因此，您独立于特定的日志库，并且可以在以后需要时轻松地更改它。

Log4Net是.NET最流行的日志库之一。ABP模板随Log4Net一起正确配置和工作。但是，log4net只有一行依赖关系（如配置部分所示），所以您可以将其更改为您最喜欢的库。

## 获取日志记录器(Logger)

无论您选择哪个日志库，编写日志的代码都是相同的（这要归功于Castle的通用ILogger接口）。

首先，我们应该得到一个Logger对象来写日志。因为ABP强烈使用依赖注入，我们可以很容易地使用属性注入（或构造函数注入）模式来注入一个记录器对象。请参见写入日志行的示例类：

```
using Castle.Core.Logging; //1: Import Logging namespace

public class TaskAppService : ITaskAppService
{    
    //2: Getting a logger using property injection
    public ILogger Logger { get; set; }

    public TaskAppService()
    {
        //3: Do not write logs if no Logger supplied.
        Logger = NullLogger.Instance;
    }

    public void CreateTask(CreateTaskInput input)
    {
        //4: Write logs
        Logger.Info("Creating a new task with description: " + input.Description);

        //TODO: save task to database...
    }
}
```

__First__ : 我们引入 Castle的ILogger 接口的命名空间

__Second__ : 我们定义了一个名为Logger的公共ILogger对象。这是我们要写日志的对象。依赖注入系统将在创建TaskAppService对象后设置（注入）此属性。这就是所谓的属性注入模式。

__Third__ : 我们将Logger设置为NullLogger.Instance. 没有这条线，系统可以正常工作。但这是属性注入模式的最佳实践。如果没有人设置记录器，它将为null，当我们想要使用它时，我们会得到一个“object reference…”异常。这保证它不是空的。因此，如果没有人设置记录器，它将是null记录器。这就是所谓的空对象模式。NullLogger实际上什么也不做，不写任何日志。因此，我们的类可以使用或不使用实际的记录器。

__Fourth__ : 最后，我们写了一个信息级别的日志文本。有不同的级别（请参阅配置部分）。

如果调用CreateTask方法并检查日志文件，则会看到如下所示的日志行：
```
INFO  2014-07-13 13:40:23,360 [8    ] SimpleTaskSystem.Tasks.TaskAppService    - Creating a new task with description: Remember to drink milk before sleeping!
```

## 自带Logger的基础类

ABP 为MVC控制器、webapi控制器、应用程序服务类等提供基类。它们声明记录器属性。所以，您可以直接使用这个记录器来写日志，不需要注入。例子：

```
public class HomeController : SimpleTaskSystemControllerBase
{
    public ActionResult Index()
    {
        Logger.Debug("A sample log message...");
        return View();
    }
}
```

请注意，SimpleTaskSystemControllerBase是我们特定于应用程序的基本控制器，它继承了AbpController。因此，它可以直接使用Logger。您还可以为其他类编写自己的公共基类。然后，您就不必每次都注入logger。

## 配置(Configuration)

当您从创建应用程序时，Log4Net的所有配置都已完成ABP 模板。
默认配置的日志格式如下所示（每行）：

* __Log level__ : DEBUG, INFO, WARN, ERROR or FATAL.
* __Date and time__ : 写入日志行的时间。
* __Thread number__ : 写入日志行的线程号。
* __Logger name__ : 这通常是写入日志行的类名。
* __Log text__ : 您编写的实际日志文本。

它被定义在程序中的 `log4net.config` 文件中，具体如下：

```
<?xml version="1.0" encoding="utf-8" ?>
<log4net>
  <appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender" >
    <file value="Logs/Logs.txt" />
    <appendToFile value="true" />
    <rollingStyle value="Size" />
    <maxSizeRollBackups value="10" />
    <maximumFileSize value="10000KB" />
    <staticLogFileName value="true" />
    <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%-5level %date [%-5.5thread] %-40.40logger - %message%newline" />
    </layout>
  </appender>
  <root>
    <appender-ref ref="RollingFileAppender" />
    <level value="DEBUG" />
  </root>
  <logger name="NHibernate">
    <level value="WARN" />
  </logger>
</log4net>
```
Log4Net是一个高度可配置和强大的日志库。您可以用不同的格式将日志写入不同的目标（文本文件、数据库…）。您可以设置最低日志级别（与此配置中为NHibernate设置的一样）。您可以将不同的记录器写入不同的日志文件。它可以在达到特定大小时自动备份和创建新的日志文件（此配置中每个文件的滚动文件适配器为10000 KB）等等。。。阅读它自己的配置文档了解更多。

最后，在Global.asax文件，我们声明将Log4Net与log4一起使用net.config文件文件：

```
public class MvcApplication : AbpWebApplication
{
    protected override void Application_Start(object sender, EventArgs e)
    {
        IocManager.Instance.IocContainer.AddFacility<LoggingFacility>(f => f.UseLog4Net().WithConfig("log4net.config"));
        base.Application_Start(sender, e);
    }
}
```

这是我们唯一直接依赖log4net的代码行。另外，只有web项目依赖于log4net库的nuget包。因此，您可以轻松地更改到另一个库，而无需更改日志代码。

### Abp.Castle.Log4Net 包

ABP使用Castle日志记录工具进行日志记录，它不直接依赖于log4net，如上所述。但是Castle的Log4Net集成有一个问题。它不支持最新的log4net。我们创建了一个nuget软件包，Abp.Castle.Log4Net网站，以解决此问题。在将这个包添加到我们的解决方案后，我们要做的就是将application start中的代码改成这样：

```
public class MvcApplication : AbpWebApplication
{
    protected override void Application_Start(object sender, EventArgs e)
    {
        IocManager.Instance.IocContainer.AddFacility<LoggingFacility>(f => f.UseAbpLog4Net().WithConfig("log4net.config"));
        base.Application_Start(sender, e);
    }
}
```
唯一区别是，我们使用了 UseAbpLog4Net() 方法 而不是 UseLog4Net() 方法，当我们使用Abp.Castle.Log4Net 包的时候。当我们使用Abp.Castle.Log4Net 包的时候，不需要再添加 `Castle.Windsor-log4net` 以及 `Castle.Core-log4net` 包。

## 客户端(Client Side)

Abp 为客户端定义了一个简单的javascript日志API。默认情况下，它会登录到浏览器的控制台。编写日志的javascript代码示例：

```
abp.log.warn('a sample log message...');
```
