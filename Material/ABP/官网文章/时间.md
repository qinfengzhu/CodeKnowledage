[TOC]

## 介绍

虽然有些应用程序针对单个时区，但有些应用程序针对许多不同的时区。为了满足这些需求并集中化日期时间操作，Abp为日期时间操作提供了通用的基础设施。

## 时钟(Clock)

Clock是用于处理DateTime值的主类。它定义了以下静态属性/方法：

* __Now__ : 根据当前提供程序获取当前时间。
* __Kind__ : 获取当前提供程序的DateTimeKind。
* __SupportMultipleTimezone__ ：获取一个值，该值指示当前提供程序可用于需要多个时区的应用程序。
* __Normalize__ : 在当前提供程序上规范化/转换给定的日期时间。

所以，不用日期时间(DateTime.Now)。现在，我们正在使用时钟(Clock.Now)。现在，抽象出：

```
DateTime now = Clock.Now;
```

时钟内部使用时钟提供程序。有三种类型的内置时钟提供程序：

* __ClockProviders.Unspecified (UnspecifiedClockProvider)__ : 这是默认的时钟提供程序，其行为与日期时间。现在. 它的作用是你根本不使用时钟类。

* __ClockProviders.Utc (UtcClockProvider) __ :  以UTC日期时间工作。日期时间.UtcNow为时钟。现在. Normalize方法将给定的日期时间转换为utc日期时间，并将其类型设置为日期时间种类.UTC. 它支持多个时区。

* __ClockProviders.Local (LocalClockProvider)__ : 在本地计算机上工作。Normalize方法将给定的日期时间转换为本地日期时间，并将其类型设置为DateTimeKind。本地.

```
Clock.Provider = ClockProviders.Utc;
```
这通常在应用程序开始时完成（在web应用程序中应用程序启动）。

### 客户端

时钟可以在客户端使用abp.clock对象。当你准备好时钟提供程序在服务器端，ABP自动设置abp.clock.provider公司在客户端。

## 时区(Time Zones)

ABP定义了一个名为Abp.Timing.TimeZone(计时SettingNames.TimeZone常量），用于存储主机、租户和用户的选定时区。ABP假定时区设置的值是有效的Windows时区名称。它还定义了一个时区映射文件，用于将Windows时区转换为IANA时区，因为某些常用库使用IANA时区id。必须使用UtcClockProvider才能支持多个时区。因为如果使用UtcClockProvider，所有datetime值都将以UTC格式存储，并且所有datetime都将以UTC格式发送到客户端。然后在客户端，我们可以使用用户当前的时区设置将UTC日期时间转换为用户的时区。

### 客户端(Client Side)

ABP创建一个名为abp.timing.timeZoneInfo包含当前用户的时区信息。此信息包含Windows和IANA时区ID以及有关Windows时区信息的一些额外信息。此信息可用于进行客户端日期时间转换，并向用户显示时区中的日期时间。

## 绑定器与转换器(Binders and Converters)

* ABP自动规范从MVC、Web API和ASP.NET核心应用程序，基于当前时钟提供程序。
* 当使用EntityFramework或NHibernate模块时，ABP根据当前时钟提供程序自动规范化从数据库接收的日期时间。

如果使用UTC时钟提供程序，则数据库中存储的所有日期时间都假定为UTC值，从客户端接收的所有日期时间都假定为UTC值，除非明确指定。
